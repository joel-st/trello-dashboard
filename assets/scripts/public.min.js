!function(e){var o={};function a(t){if(o[t])return o[t].exports;var n=o[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=e,a.c=o,a.d=function(t,n,e){a.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:e})},a.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(n,t){if(1&t&&(n=a(n)),8&t)return n;if(4&t&&"object"==typeof n&&n&&n.__esModule)return n;var e=Object.create(null);if(a.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:n}),2&t&&"string"!=typeof n)for(var o in n)a.d(e,o,function(t){return n[t]}.bind(null,o));return e},a.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(n,"a",n),n},a.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},a.p="",a(a.s=2)}({2:function(t,n,e){"use strict";function o(t,n,e){var o,a="";e&&((o=new Date).setTime("".concat(o.getTime()).concat(e||2592e6)),a='; expiryDate=" '.concat(o.toUTCString())),document.cookie="".concat(t,"=").concat(n||"").concat(a,"; path=/")}e.r(n);var a={get:function(t){return(t=document.cookie.match("(^|[^;]+)\\s*"+t+"\\s*=\\s*([^;]+)"))?t.pop():""},set:o,update:function(){console.log("updateCookie")},remove:function(t){o(t,"",-1)}};var i={initSignup:function(){function n(){console.log(tvpTdVars.i18n.trelloAuthenticationSuccess),location.reload()}function e(){console.log(tvpTdVars.i18n.trelloAuthenticationFailure)}$("#tvptd-signup-with-trello").on("click",function(t){t.preventDefault(),window.Trello.authorize({type:"popup",name:"TVP Trello Dashboard",scope:{read:"true",write:"false",account:"true"},expiration:"never",success:n,error:e})})}};var r={loadOverview:function(){var t=$("#tvptd-organization-overview"),n=$("#tvptd-organization-overview .tvptd__widget-content");t&&$.ajax({type:"GET",url:tvpTdVars.ajaxUrl,data:{action:"tvptd-public-ajax-get-organization-overview"},success:function(t){t=JSON.parse(t);n.html(t.html),n.removeClass("tvptd__widget-content--loading")},error:function(t){n.html('<section class="tvptd__widget-section">Oups, something went wrong wile loading the overview.</section>'),n.removeClass("tvptd__widget-content--loading")}})},loadStatistics:function n(){var t=0<arguments.length&&void 0!==arguments[0]&&arguments[0],e=$("#tvptd-organization-statistics"),o=$("#tvptd-organization-statistics .tvptd__widget-content"),a=$("#tvptd-organization-statistics-timerange");a.on("change",function(t){n(t.target.value)}),t=t||a.val(),e&&(o.addClass("tvptd__widget-content--loading"),o.html('<div class="tvptd__spinner spinner"></div>'),$.ajax({type:"GET",url:tvpTdVars.ajaxUrl,data:{action:"tvptd-public-ajax-get-organization-statistics",timeRange:t},success:function(t){t=JSON.parse(t),o.html(t.html),o.removeClass("tvptd__widget-content--loading")},error:function(t){o.html('<section class="tvptd__widget-section">Oups, something went wrong wile loading the statistics.</section>'),o.removeClass("tvptd__widget-content--loading")}}))}};var c={init:function(){var t=$("#tvptd-profile"),n=$("#tvptd-logout");t.on("click",function(){t.toggleClass("active")}),n.on("click",function(){s.logout()})}};var l,s={login:function(t,n){var e=$("#tvptd-loading");$.ajax({type:"GET",url:tvpTdVars.ajaxUrl,data:{action:"tvptd-public-ajax-login",nonce:tvpTdVars.nonces.login,member:{id:t.id,email:t.email},membership:n},success:function(t){$.ajax({type:"GET",url:tvpTdVars.ajaxUrl,data:{action:"tvptd-public-ajax-get-dashboard-content",nonce:tvpTdVars.nonces.content},success:function(t){t=JSON.parse(t);e.replaceWith(t.html),e.attr("id","tvptd"),c.init(),r.loadOverview(),r.loadStatistics()}})},error:function(t){alert("Oups, sorry, something went wrong. Try it again later.")}})},logout:function(){Trello.deauthorize(),$.ajax({type:"GET",url:tvpTdVars.ajaxUrl,data:{action:"tvptd-public-ajax-logout",nonce:tvpTdVars.nonces.logout},success:function(t){location.reload()}})}};(l=jQuery)(function(){var t,n=l("#tvptd-loading");function e(){l.ajax({type:"GET",url:tvpTdVars.ajaxUrl,data:{action:"tvptd-public-ajax-get-not-in-organization-content",nonce:tvpTdVars.nonces.signup},success:function(t){t=JSON.parse(t);n.replaceWith(t.html),Trello.deauthorize()}})}n.length&&(t=localStorage.trello_token||!1,a.get(tvpTdVars.authCookie),t?(Trello.setToken(t),Trello.authorized()?Trello.members.get("me",function(n){n.idOrganizations.includes(tvpTdVars.trelloOrganization)?Trello.get("organizations/"+tvpTdVars.trelloOrganization+"/memberships",function(t){t=t.filter(function(t){return t.idMember==n.id}),t=!!t&&t[0];t?s.login(n,t):e()}):e()}):s.logout()):l.ajax({type:"GET",url:tvpTdVars.ajaxUrl,data:{action:"tvptd-public-ajax-get-signup-content",nonce:tvpTdVars.nonces.signup},success:function(t){t=JSON.parse(t);n.replaceWith(t.html),i.initSignup()}}))})}});